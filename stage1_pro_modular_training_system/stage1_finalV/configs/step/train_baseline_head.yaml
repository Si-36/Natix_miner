# ============================================================================
# Step Config: train_baseline_head (Phase 1 Baseline Training)
# ============================================================================
# Step Spec: Train DINOv3 backbone + Stage1Head (binary classifier)
# Depends on: None (first step in DAG)
# Outputs: MODEL_CHECKPOINT, VAL_SELECT_METRICS, VAL_CALIB_LOGITS, VAL_CALIB_LABELS
# Allowed Splits: TRAIN, VAL_SELECT (NO VAL_CALIB IN TRAINING!)
#
# Lightning Best Practices:
# - AdamW optimizer with cosine scheduling
# - BF16 mixed precision
# - torch.compile support (30-50% speedup)
# - Real ML execution (not just definitions!)
# ============================================================================

model:
  backbone:
    family: dinov3
    model_id: facebook/dinov3-vits16-pretrain-lvd1689m
    hidden_dim: 384
    freeze_backbone: true  # Phase 1: Linear probing only!
    precision: bf16
  
  head:
    name: stage1_head
    hidden_dim: 384
    num_classes: 2
    dropout: 0.1

training:
  max_epochs: 50
  batch_size: 32
  learning_rate: 1e-4
  weight_decay: 1e-4
  optimizer: adamw
  scheduler: cosine
  warmup_epochs: 2
  max_grad_norm: 1.0
  compile_model: false  # torch.compile (30-50% speedup)
  
  # ðŸ”¥ 2026 PRO: Export calibration artifacts (leak-proof!)
  save_calibration_data: true  # Export VAL_CALIB_LOGITS, VAL_CALIB_LABELS
  calibration_split: val_calib  # ONLY val_calib (not val_select!)

data:
  # Dataset paths (will be overridden by hydra)
  root: ./data
  splits:
    train: train
    val_select: val_select
    val_calib: val_calib
    val_test: val_test
  
  # Image preprocessing (DINOv3 standard)
  image_size: 224
  normalize: true
  augmentation: true

# ============================================================================
# Step Metadata (for RunManifest)
# ============================================================================

step:
  name: train_baseline_head
  version: 1.0.0
  owners:
    - ml-team
    - vision-team
  tags:
    priority: high
    stage: baseline
    component: training
    backbone: dinov3_vits16
    method: frozen_backbone_linear_probing

