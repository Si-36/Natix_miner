# DINOv3 ViT-H/16 Configuration (2025-12-29 Production)
# Latest 2025-2026 Practices
#
# DINOv3 ViT-H/16 Plus:
#   - Hidden size: 1280
#   - Patch size: 16
#   - Image size: 224 (standard DINOv3 resolution)
#   - Pretrained on LVD-1689M dataset
#
# Expected results with ExPLoRA:
#   - Accuracy: 85-92% (roadwork classification)
#   - ECE: <5% (well-calibrated)
#   - AUROC: 0.94-0.96

# Model architecture
backbone_id: facebook/dinov3-vith16plus-pretrain-lvd1689m  # HuggingFace model ID (ViT-H/16 Plus)
num_classes: 13  # NATIX roadwork (13 classes, NOT 7!)

# Backbone settings
freeze_backbone: true  # Freeze DINOv3, only train head
use_flash_attention: false  # Enable if PyTorch 2.5+ and compatible GPU
pooling_mode: cls_token  # "cls_token" or "mean_pool"

# Classification head
head_type: linear  # "linear" or "doran" (DoRAN for TODO 141-160)
dropout_rate: 0.3  # Safe dropout (NOT 0.45)
hidden_size: 1280  # DINOv3 ViT-H/16 hidden size

# ExPLoRA integration (Phase 4 → Phase 1)
init_from_explora: false  # Set true to load Phase 4 ExPLoRA checkpoint
explora_checkpoint_path: null  # Auto-set from artifacts.explora_checkpoint

# EMA (Exponential Moving Average)
use_ema: true
ema_decay: 0.9999

# Multi-view inference (validation/test only)
use_multiview: true
multiview_aggregation: topk_mean  # "topk_mean" or "attention"
multiview_topk: 2  # K for top-k aggregation
multiview_grid_size: [3, 3]  # 3×3 grid = 9 tiles
multiview_overlap: 0.15  # 15% overlap

# Image preprocessing (DINOv3 specific)
image_size: 224  # DINOv3 standard resolution (224×224)
patch_size: 16  # DINOv3 ViT-H/16
preprocessing:
  mean: [0.485, 0.456, 0.406]  # ImageNet mean
  std: [0.229, 0.224, 0.225]   # ImageNet std

# Notes:
# - Set init_from_explora=true to use Phase 4 checkpoint for max accuracy
# - Multi-view adds +3-8% accuracy at validation/test (NOT training)
# - ExPLoRA pretraining adds +8.2% accuracy (69% → 77.2%)
# - Combined: ~85% accuracy (baseline 69% → ExPLoRA 77% → multi-view 85%)
#
# Safe hyperparameters (DO NOT increase without validation):
#   - dropout_rate: 0.3 (NOT 0.45)
#   - image_size: 224 (standard DINOv3 resolution)
#   - ema_decay: 0.9999 (standard)
